<h3 class="text-primary mb-4">Manage Credentials</h3>

<form #formRef="ngForm" (ngSubmit)="submitCredentials(formRef)" novalidate>
    <div class="row align-items-center mb-4 position-relative" style="min-height: 100px;">

        <div class="col-md-4 col-lg-3">
            <label for="doctorSelect" class="form-label fw-semibold text-secondary">Select Doctor</label>

            <ng-select id="doctorSelect" name="doctorId" #doctorSelect="ngModel" [(ngModel)]="credentials.doctorId"
                [items]="doctorList" bindLabel="fullName" bindValue="DoctorID" placeholder="-- Select a Doctor --"
                required (change)="onDoctorChange($event)" [searchable]="true" [clearable]="true" class="shadow-sm"
                [ngClass]="{
                               'is-invalid': doctorSelect.invalid && (doctorSelect.touched || formRef.submitted),
                               'is-valid': doctorSelect.valid && (doctorSelect.touched || formRef.submitted)
                           }">
            </ng-select>

            <div *ngIf="doctorSelect.invalid && (doctorSelect.touched || formRef.submitted)"
                class="invalid-feedback d-block">
                Doctor selection is required.
            </div>
        </div>

        <div class="col-md col-lg-5 d-flex align-items-center">
            <div class="doctor-card-container">

                <div class="border rounded-3 bg-light p-3 shadow-sm small fade-in" *ngIf="selectedDoctor">

                    <div class="fw-semibold text-primary mb-1">
                        {{ selectedDoctor.FirstName }} {{ selectedDoctor.LastName }}
                    </div>

                    <div class="text-muted">
                        <div><strong>Phone:</strong> {{ selectedDoctor.PhoneNumber || '-' }}</div>
                        <div><strong>Qualification:</strong> {{ selectedDoctor.QualificationName || '-' }}</div>
                    </div>

                </div>

            </div>
        </div>
    </div>

    <div class="row g-3">
        <div class="col-md-4">
            <label class="form-label fw-semibold text-secondary">Email</label>
            <input type="email" name="email" [(ngModel)]="credentials.email" class="form-control shadow-sm"
                placeholder="Enter email" required #emailCtrl="ngModel" [ngClass]="{
          'is-invalid': (!isValidEmail(emailCtrl.value) && emailCtrl.touched) || (emailCtrl.invalid && formRef.submitted),
          'is-valid': isValidEmail(emailCtrl.value) && emailCtrl.touched
        }" />

            <div *ngIf="emailCtrl.touched || formRef.submitted">
                <div *ngIf="!credentials.email" class="invalid-feedback d-block">Email is required.</div>
                <div *ngIf="credentials.email && !isValidEmail(credentials.email)" class="invalid-feedback d-block">
                    Please enter a valid email address.
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <label class="form-label fw-semibold text-secondary">Password</label>
            <input type="password" name="password" [(ngModel)]="credentials.password" class="form-control shadow-sm"
                placeholder="Enter password" required #passwordCtrl="ngModel" [ngClass]="{
          'is-invalid': (!isValidPassword(passwordCtrl.value) && passwordCtrl.touched) || (passwordCtrl.invalid && formRef.submitted),
          'is-valid': isValidPassword(passwordCtrl.value) && passwordCtrl.touched
        }" />

            <div *ngIf="passwordCtrl.touched || formRef.submitted">
                <div *ngIf="!credentials.password" class="invalid-feedback d-block">Password is required.</div>
                <div *ngIf="credentials.password && !isValidPassword(credentials.password)"
                    class="invalid-feedback d-block">
                    Password must be at least 8 characters long and include uppercase, lowercase, number, and special
                    character.
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <label class="form-label fw-semibold text-secondary">Role</label>
            <ng-select name="roleId" #roleSelect="ngModel" [(ngModel)]="credentials.roleId" [items]="roles"
                bindLabel="roleName" bindValue="roleId" placeholder="-- Select Role --" required [clearable]="true"
                class="shadow-sm" [ngClass]="{
          'is-invalid': roleSelect.invalid && (roleSelect.touched || formRef.submitted),
          'is-valid': roleSelect.valid && (roleSelect.touched || formRef.submitted)
        }">
            </ng-select>

            <div *ngIf="roleSelect.invalid && (roleSelect.touched || formRef.submitted)"
                class="invalid-feedback d-block">
                Role selection is required.
            </div>
        </div>

        <div class="row mt-3">
            <div class="col-md-2">
                <button class="btn btn-primary shadow-sm px-4 mt-2" type="submit">Save Credentials</button>
            </div>
        </div>
    </div>
</form>